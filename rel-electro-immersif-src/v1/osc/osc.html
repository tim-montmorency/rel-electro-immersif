<!DOCTYPE HTML>
<html lang="fr" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Open Sound Control (OSC)</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
            <link rel="stylesheet" href="../glightbox/dist/css/glightbox.min.css" />
           <script src="../glightbox/dist/js/glightbox.min.js"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../couverture.html"><strong aria-hidden="true">1.</strong> Couverture</a></li><li class="chapter-item expanded "><a href="../rel-electro-immersif.html"><strong aria-hidden="true">2.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../osc_espace_immersif/osc_espace_immersif.html"><strong aria-hidden="true">3.</strong> Objectif final</a></li><li class="chapter-item expanded affix "><li class="part-title">Électronique</li><li class="chapter-item expanded "><a href="../electricite/electricite.html"><strong aria-hidden="true">4.</strong> Électricité</a></li><li class="chapter-item expanded "><a href="../schemas_circuits/schemas_circuits.html"><strong aria-hidden="true">5.</strong> Schémas de circuit</a></li><li class="chapter-item expanded "><a href="../platine_experimentation/platine_experimentation.html"><strong aria-hidden="true">6.</strong> Platine d'expérimentation</a></li><li class="chapter-item expanded "><a href="../erreurs_fatales/erreurs_fatales.html"><strong aria-hidden="true">7.</strong> Erreurs fatales</a></li><li class="chapter-item expanded "><a href="../del/del.html"><strong aria-hidden="true">8.</strong> DEL</a></li><li class="chapter-item expanded "><a href="../resistance/resistance.html"><strong aria-hidden="true">9.</strong> Résistance</a></li><li class="chapter-item expanded "><a href="../alimenter_del/alimenter_del.html"><strong aria-hidden="true">10.</strong> Alimenter une DEL</a></li><li class="chapter-item expanded "><a href="../micro-soudure/micro-soudure.html"><strong aria-hidden="true">11.</strong> Micro-soudure</a></li><li class="chapter-item expanded "><a href="../multimetre/multimetre.html"><strong aria-hidden="true">12.</strong> Multimètre</a></li><li class="chapter-item expanded affix "><li class="part-title">Cartes Arduino</li><li class="chapter-item expanded "><a href="../arduino_cartes/arduino_cartes.html"><strong aria-hidden="true">13.</strong> Modèles de cartes</a></li><li class="chapter-item expanded "><a href="../arduino_nano/arduino_nano.html"><strong aria-hidden="true">14.</strong> Cartes Arduino Nano</a></li><li class="chapter-item expanded affix "><li class="part-title">Arduino IDE</li><li class="chapter-item expanded "><a href="../arduino-ide/fenetre_principale.html"><strong aria-hidden="true">15.</strong> Fenêtre principale</a></li><li class="chapter-item expanded "><a href="../arduino-ide_configuration_nano/arduino-ide_configuration_nano.html"><strong aria-hidden="true">16.</strong> Configuration du port</a></li><li class="chapter-item expanded "><a href="../arduino-ide_test_blink/arduino-ide_test_blink.html"><strong aria-hidden="true">17.</strong> Blink: le code test universel</a></li><li class="chapter-item expanded affix "><li class="part-title">Algorithmie I</li><li class="chapter-item expanded "><a href="../arduino_code/arduino_code.html"><strong aria-hidden="true">18.</strong> Le code Arduino</a></li><li class="chapter-item expanded "><a href="../arduino_millis/arduino_millis.html"><strong aria-hidden="true">19.</strong> Mesurer le temps</a></li><li class="chapter-item expanded "><a href="../intervalle/intervalle.html"><strong aria-hidden="true">20.</strong> Intervalle de temps</a></li><li class="chapter-item expanded affix "><li class="part-title">Les sorties numériques</li><li class="chapter-item expanded "><a href="../sortie_numerique/sortie_numerique.html"><strong aria-hidden="true">21.</strong> Sortie numérique</a></li><li class="chapter-item expanded "><a href="../arduino_exemple_del/arduino_exemple_del.html"><strong aria-hidden="true">22.</strong> Contrôle d'une DEL</a></li><li class="chapter-item expanded affix "><li class="part-title">Algorithmie II</li><li class="chapter-item expanded "><a href="../arduino_deboguer/arduino_deboguer.html"><strong aria-hidden="true">23.</strong> Déboguage série ASCII</a></li><li class="chapter-item expanded affix "><li class="part-title">Les entrées numériques</li><li class="chapter-item expanded "><a href="../entree_numerique/entree_numerique.html"><strong aria-hidden="true">24.</strong> Entrée numérique</a></li><li class="chapter-item expanded "><a href="../interrupteur/interrupteur.html"><strong aria-hidden="true">25.</strong> Interrupteur</a></li><li class="chapter-item expanded "><a href="../bouton_poussoir/bouton_poussoir.html"><strong aria-hidden="true">26.</strong> Bouton poussoir</a></li><li class="chapter-item expanded "><a href="../bouton_arcade/bouton_arcade.html"><strong aria-hidden="true">27.</strong> Bouton d'arcade</a></li><li class="chapter-item expanded affix "><li class="part-title">Algorithmie III</li><li class="chapter-item expanded "><a href="../changement/changement.html"><strong aria-hidden="true">28.</strong> Changement de valeur</a></li><li class="chapter-item expanded "><a href="../envoi_optimal_de_valeur/envoi_optimal_de_valeur.html"><strong aria-hidden="true">29.</strong> Envoi optimal de valeur</a></li><li class="chapter-item expanded affix "><li class="part-title">Les entrées analogiques</li><li class="chapter-item expanded "><a href="../entree_analogique/entree_analogique.html"><strong aria-hidden="true">30.</strong> Entrée analogique</a></li><li class="chapter-item expanded "><a href="../potentiometre/potentiometre.html"><strong aria-hidden="true">31.</strong> Potentiomètre</a></li><li class="chapter-item expanded "><a href="../photoresistance/photoresistance.html"><strong aria-hidden="true">32.</strong> Photorésistance</a></li><li class="chapter-item expanded affix "><li class="part-title">Les sorties analogiques</li><li class="chapter-item expanded "><a href="../sortie_analogique/sortie_analogique.html"><strong aria-hidden="true">33.</strong> Sortie analogique</a></li><li class="chapter-item expanded "><a href="../chandelle/chandelle.html"><strong aria-hidden="true">34.</strong> Simuler une chandelle</a></li><li class="chapter-item expanded affix "><li class="part-title">OSC</li><li class="chapter-item expanded "><a href="../osc/osc.html" class="active"><strong aria-hidden="true">35.</strong> Open Sound Control (OSC)</a></li><li class="chapter-item expanded "><a href="../microosc/microosc.html"><strong aria-hidden="true">36.</strong> MicroOsc</a></li><li class="chapter-item expanded "><a href="../osc_slip/osc_slip.html"><strong aria-hidden="true">37.</strong> OSC SLIP avec MicroOsc</a></li><li class="chapter-item expanded affix "><li class="part-title">OSC SLIP</li><li class="chapter-item expanded "><a href="../pd/osc_slip.html"><strong aria-hidden="true">38.</strong> OSC SLIP : Pure Data (PD)</a></li><li class="chapter-item expanded "><a href="../max/max_osc_slip.html"><strong aria-hidden="true">39.</strong> OSC SLIP : Cycling '74 Max</a></li><li class="chapter-item expanded "><a href="../osc_slip_web/osc_slip_web.html"><strong aria-hidden="true">40.</strong> OSC SLIP : Web/Node.js</a></li><li class="chapter-item expanded affix "><li class="part-title">OSC UDP</li><li class="chapter-item expanded "><a href="../pd/relais_osc_slip_udp.html"><strong aria-hidden="true">41.</strong> Relais SLIP⇄UDP avec PD</a></li><li class="chapter-item expanded "><a href="../max/relais_osc_slip_udp.html"><strong aria-hidden="true">42.</strong> Relais SLIP⇄UDP avec Max</a></li><li class="chapter-item expanded "><a href="../pd/pd_osc_udp.html"><strong aria-hidden="true">43.</strong> OSC UDP : Pure Data</a></li><li class="chapter-item expanded "><a href="../max/max_osc_udp.html"><strong aria-hidden="true">44.</strong> OSC UDP : Cycling '74 Max</a></li><li class="chapter-item expanded "><a href="../vcv_rack/vcv_rack_osc.html"><strong aria-hidden="true">45.</strong> OSC UDP : VCV Rack</a></li><li class="chapter-item expanded "><a href="../osc_udp_unity/osc_udp_unity.html"><strong aria-hidden="true">46.</strong> OSC UDP : Unity</a></li><li class="chapter-item expanded "><a href="../touchdesigner/td_osc_udp.html"><strong aria-hidden="true">47.</strong> OSC UDP : TouchDesigner</a></li><li class="chapter-item expanded affix "><li class="part-title">Les bandes de DEL</li><li class="chapter-item expanded "><a href="../bande_del/bande_del.html"><strong aria-hidden="true">48.</strong> Bande de DEL</a></li><li class="chapter-item expanded "><a href="../pong_1d/pong_1d.html"><strong aria-hidden="true">49.</strong> Pong 1D</a></li><li class="chapter-item expanded "><a href="../bande_del_osc/bande_del_osc.html"><strong aria-hidden="true">50.</strong> Contrôle par OSC</a></li><li class="chapter-item expanded affix "><li class="part-title">Déploiement</li><li class="chapter-item expanded "><a href="../raspberry_pi/raspberry_pi.html"><strong aria-hidden="true">51.</strong> Raspberry PI</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div id="ToC"></div>
                        <h1 id="open-sound-control-osc"><a class="header" href="#open-sound-control-osc">Open Sound Control (OSC)</a></h1>
<p>L'<em>Open Sound Control</em> (OSC) est un protocole de communication inter-applications. Contrairement à ce qu'indique son nom, il ne concerne pas uniquement le son, mais offre un système d'organisation générique mais uniformisé de l'information pertinent au contrôle de n'importe quel système, multimédia ou pas. L'OSC a été développé à UC Berkeley Center for New Music and Audio Technology (CNMAT).</p>
<h2 id="pourquoi-losc"><a class="header" href="#pourquoi-losc">Pourquoi l'OSC?</a></h2>
<p>La plupart des protocoles (COBS, JSON, FUDI, etc.) permettent une trop grande latitude dans la manière d'organiser les données, et s'appuient donc sur des architectures personnalisées spécifiques à chaque développeur. L'OSC impose une structure particulière de l'information que toutes les applications doivent supporter ce qui rend toute communication plus universelle : tout le monde parle la même langue!</p>
<p>L'OSC fournit également une vérification (primitive) des erreurs de transmission, ce qui est très important lorsque l'on travaille avec flux susceptibles au bruit!</p>
<h2 id="client-et-serveur"><a class="header" href="#client-et-serveur">Client et serveur</a></h2>
<ul>
<li>Une application qui envoie de l'OSC est un <strong>client OSC</strong>. </li>
<li>Une application qui reçoit de l'OSC est un <strong>serveur OSC</strong>. </li>
<li>Habituellement, toutes les applications qui supportent l'OSC sont <em>client OSC</em> et <em>serveur OSC</em> (elles peuvent donc supporter la réception et l'envoi de messages OSC).</li>
</ul>
<h2 id="unité-de-transmission"><a class="header" href="#unité-de-transmission">Unité de transmission</a></h2>
<ul>
<li>L'unité de transmission de l'OSC est le <strong>message</strong> ou le <strong>bundle</strong>. Un <strong>bundle</strong> contient un ou plusieurs messages et un <strong>timetag</strong>.</li>
<li>L'OSC est unidirectionnel et n'offre pas d'accusé de réception (on ne sait pas si le destinataire a reçu le message).</li>
</ul>
<h2 id="paquetage"><a class="header" href="#paquetage">Paquetage</a></h2>
<p>L'OSC ne définit pas la mise en paquet des messages. </p>
<p>Les deux types de paquets les plus communs sont:</p>
<ul>
<li><strong>UDP</strong> (le mode par défaut) pour la communication par réseau ou interne de l'ordinateur</li>
<li><strong>SLIP</strong> (souvent nommé <strong>OSC SLIP</strong>) pour la communication par série (USB) avec des microcontrôleurs plus vieux</li>
</ul>
<h3 id="par-udp"><a class="header" href="#par-udp">Par UDP</a></h3>
<p>De façon générale, l'OSC est envoyé sur un réseau par <em>UDP</em>. </p>
<p>Pour envoyer un message, il faut spécifier l'adresse UDP du destinataire. Cette adresse se compose de deux parties:</p>
<ul>
<li>IP de la machine adressée.</li>
<li>Port du client OSC.</li>
</ul>
<p>Pour recevoir un message , il faut simplement spécifier le port de réception.</p>
<h3 id="par-slip"><a class="header" href="#par-slip">Par SLIP</a></h3>
<p>Le <em>SLIP</em> ne permet pas d'adresser les messages à des destinataires spécifiques. Seule l'application qui est connectée au port série peut envoyer et recevoir des messages (qu'elle peut relayer par la suite par UDP si nécessaire).</p>
<h2 id="exemples-darchitectures"><a class="header" href="#exemples-darchitectures">Exemples d'architectures</a></h2>
<h3 id="un-client-sur-une-machine---un-serveur-sur-une-autre-machine"><a class="header" href="#un-client-sur-une-machine---un-serveur-sur-une-autre-machine">Un client sur une machine -&gt; un serveur sur une autre machine</a></h3>
<p><img src="./OSC_unidirectionnel.png" alt="Un client qui envoie des message à un serveur" /></p>
<h3 id="une-machine---une-autre-machine"><a class="header" href="#une-machine---une-autre-machine">Une machine &lt;-&gt; une autre machine</a></h3>
<p><img src="./OSC_bidirectionnel.png" alt="Deux clients/serveurs" /></p>
<h3 id="un-client---un-serveur-sur-la-même-machine"><a class="header" href="#un-client---un-serveur-sur-la-même-machine">Un client -&gt; un serveur sur la même machine</a></h3>
<p>L'architecture suivante  permet d'envoyer un message entre deux applications différentes sur la même machine (ou à l'intérieur de la même application). L'adresse IP <strong>127.0.0.1</strong> veut dire «la machine elle-même».</p>
<p><img src="./OSC_mono.png" alt="Un client qui envoie des message à un serveur local (sur la même machine)" /></p>
<h2 id="composition-dun-bundle-osc"><a class="header" href="#composition-dun-bundle-osc">Composition d'un bundle OSC</a></h2>
<p>Un bundle OSC contient plusieurs messages OSC. Il sert surtout à s'assurer que plusieurs messages arrivent simultanément au destinataire. </p>
<h2 id="composition-dun-message-osc"><a class="header" href="#composition-dun-message-osc">Composition d'un message OSC</a></h2>
<p>Un message OSC est composé des éléments suivants:</p>
<ul>
<li>une <strong>adresse</strong></li>
<li>un ou plusieurs <strong>arguments</strong></li>
</ul>
<h3 id="adresse"><a class="header" href="#adresse">Adresse</a></h3>
<p>L'adresse indique quel est le paramètre que l'on veut modifier. Elle peut être composée de n'importe quelle lettre et chiffre. Par contre, voici quelques recommandations à suivre lorsque vous concevez votre propre serveur OSC:</p>
<ul>
<li>Une adresse doit toujours commencer par <code>/</code> (attention, dans certains logiciels comme Pure Data ou TouchDesigner, le <code>/</code>  est implicite).</li>
<li>Chaque <code>/</code> subdivise l'adresse en hiérarchie symbolique. Plus une subdivision se trouve au début, plus est elle haute dans hiérarchie. Prenons comme exemple <code>/A/B</code> : <code>A</code> englobe <code>B</code> et <code>B</code> fait partie de <code>A</code>.</li>
<li>Tous les <em>espaces</em> doivent être remplacés par des <code>_</code>.</li>
</ul>
<p>Quelques exemples: </p>
<pre><code>/application/fenetre/bouton
/torse/bras/main/doigt/index
/renoise/pattern_name
</code></pre>
<h3 id="arguments"><a class="header" href="#arguments">Arguments</a></h3>
<p>Chaque argument possède un type. Il existe quatre types de base :</p>
<ul>
<li><em>int</em> : nombre entier à 32 bit.</li>
<li><em>float</em> : nombre à virgule à 32 bit.</li>
<li><em>string</em> : chaîne de caractères.</li>
<li><em>blob</em> : un tableau d'octets (byte).</li>
</ul>
<p>Un message OSC peut mélanger plusieurs types d'arguments différents et peut contenir n'importe quel nombre d'arguments. </p>
<p>Quelques exemples: </p>
<pre><code>/application/fenetre/bouton 1
/torse/bras/main/doigt/index 0.324
/renoise/pattern_name intro 43
</code></pre>
<p>Voici quelques recommandations à suivre lorsque vous concevez votre propre serveur OSC:</p>
<ul>
<li>Essayer de réduire le nombre d'arguments au profit d'un adressage plus complet. Cela respecte mieux la hiérarchie de l'adressage et plusieurs serveurs OSC ne supportent qu'un seul argument à la fois. Par exemple, utiliser <code>/piste/0/vol 1.</code> a un seul argument plutôt que <code>/piste/vol 0 1.</code> à deux arguments.</li>
<li>Utiliser autant que possible des nombres réels normalisés entre <code>0.</code> et <code>1.</code> pour plus de compatibilité.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../chandelle/chandelle.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../microosc/microosc.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../chandelle/chandelle.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../microosc/microosc.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
         <script type="text/javascript">
              // LIGHT BOX FOR VIDEOS
              // https://github.com/biati-digital/glightbox
              const main = document.getElementsByTagName('main')[0];
              var collectionOrNodes = main.getElementsByTagName('a');
              var a = Array.prototype.slice.call( collectionOrNodes );
              //console.log("Elements in main: "+a.length);
              a.forEach(function(currentElement){ 
                
                if ( currentElement.href.includes("youtube.com") || currentElement.href.includes("vimeo.com" ) ) {
                    currentElement.classList.add("glightboxed")
                }
                
                 });


                    var lightbox = GLightbox({
                        selector: '.glightboxed',
                        touchNavigation: true,
                        loop: false,
                        autoplayVideos: false,
                    });
                    lightbox.on('open', (target) => {
                        console.log('lightbox opened');
                    });
          </script>

          <script type="text/javascript">
              function altTextToImageCaption() {
                  let imgs = document.getElementsByTagName('img');
                  for (var i = 0; i < imgs.length; i++) {
      
                    var att = imgs[i].attributes.getNamedItem('alt');
                    if (!att) continue;
                    var alt = att.value;
                    if (!alt) continue;
                    //if (!alt.startsWith('Fig ')) continue;
                    var cap = document.createElement('div');
                    cap.setAttribute('class', 'imageCaption');
                    cap.appendChild(document.createTextNode(alt));
                    //imgs[i].parentNode.insertBefore(cap, imgs[i].nextSibling);
                    let containerDiv =  document.createElement('div');
                    //containerDiv.style.backgroundColor ='white';
                    //containerDiv.style.justifyContent = 'center';
                     //containerDiv.style.display = 'inline';
                    containerDiv.style.textAlign = 'center';
                    imgs[i].parentNode.appendChild(containerDiv);
                    containerDiv.appendChild(imgs[i]);
                    containerDiv.appendChild(cap);

                  }
                }
                altTextToImageCaption();

                function externalLinksOpenBlank() {
                    var anchorEls = document.querySelectorAll('a');
                    var anchorElsLength = anchorEls.length;

                    for (var i = 0; i < anchorElsLength; i++) {
                        var anchorEl = anchorEls[i];
                        var href = anchorEl.getAttribute('href');

                        if (href.startsWith("http",0)) {
                          anchorEl.setAttribute('target', '_blank');
                        }
                    }
                }
                externalLinksOpenBlank();

                function buildToc() {
                    
                    let tagetList = document.getElementsByTagName("h1");

                                        // Get the h2 tags — ToC entries
                    let headers = document.getElementsByTagName("h2");
                    if ( headers.length < 2) return;
                    
                     
                    if (tagetList.length < 1) return
                    let target = null;
                    for (i =0; i<tagetList.length;i++){
                      
                        if ( tagetList[i].children.length > 0 ) {
                            
                            if ( tagetList[i].children[0].classList.contains("header")) {
                                target = tagetList[i];
                                
                                break;
                            }
                        }
                    }
                    if ( target == null) return;

                    // Create a list for the ToC entries
                    let tocList = document.createElement("ul"); 

                    // Add a begin if missing a first header
                    if ( !(target.nextElementSibling.tagName == "H2" || target.nextElementSibling.tagName == "h2") )   {
                        let tocListItem = document.createElement("li");    
                        let tocEntry = document.createElement("a");
                        
                        tocEntry.setAttribute("href","#");
                        tocEntry.innerText="Début";
                     
                        tocListItem.appendChild(tocEntry);
                        tocList.appendChild(tocListItem);
                    }
                    
                                         

                     

                     
                     // For each h3
                     for (i = 0; i < headers.length; i++){
                     
                        // Create an id
                        //name = "h"+i;
                        //headers[i].id=name;
                     
                        // a list item for the entry
                        let tocListItem = document.createElement("li");    
                        let tocEntry = document.createElement("a");
                        
                        tocEntry.setAttribute("href",headers[i].children[0].href);
                        tocEntry.innerText=headers[i].innerText;
                     
                        tocListItem.appendChild(tocEntry);
                        tocList.appendChild(tocListItem);
                     }
                     target.parentNode.insertBefore(tocList, target.nextSibling);
                     //toc.insertBefore(tocList);
                }
                buildToc();

                
          </script>

    </body>
</html>
